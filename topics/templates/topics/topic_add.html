{% extends "base.html" %}
{% load staticfiles %}
{% block header_css %}
<link href="{% static 'bootstrap-select/css/bootstrap-select.css' %}" rel="stylesheet">
{% endblock %}

{% block main-content %}
  <div class="panel panel-default">
    <div class="panel-heading">发布新话题</div>
    <div class="panel-body">
      <form method="post" class="simple_form">
        {% csrf_token %}
        <div class="form-group">
          <div class="input-group">
            <span class="node-select input-group-btn">
              <select name="node" class="selectpicker show-menu-arrow" data-live-search="true" data-width="140px" title="选择节点" >
                {% for section in sections %}
                <optgroup label="{{ section.name }}">
                  {% for node in section.nodes %}
                  <option value="{{ node.id }}">{{ node.name }}</option>
                  {% endfor %}
                </optgroup>
                {% endfor %}
              </select>
            </span>
            <input name="title" class="form-control" type="text" placeholder="在这里填写标题" style="margin-left: 2%;width: 98%;">
          </div>
        </div>
        <div class="form-group">
          <textarea name="content" class="form-control" style="height: 400px;"></textarea>
        </div>
        <div class="form-group">
          <input class="btn btn-primary" style="padding-left: 60px;padding-right: 60px;" type="submit" value="保存">
        </div>

      </form>
    </div>
  </div>
{% endblock %}

{% block footer-js %}
<script src="{% static 'bootstrap-select/js/bootstrap-select.js' %}"></script>
<script src="{% static 'bootstrap-select/js/i18n/defaults-zh_CN.js' %}"></script>

<!-- jQuery Validation -->
<script src="{% static 'jquery-validation/jquery.validate.min.js' %}"></script>
<script src="{% static 'jquery-validation/localization/messages_zh.min.js' %}"></script>
<script src="{% static 'web/js/jquery-bootstrap-validator.js' %}"></script>
<script>
$("form").validate({
  rules: {
    name: "required",
    nickname: "required",
    password: "required",
    password_confirmation: {equalTo: "#id_password"},
    captcha: "required",
    avatar: {
      required: true,
      url: true
    }
  }
});
</script>

<!-- qiniu upload image -->
<script src="{% static 'plupload/plupload.full.min.js' %}"></script>
<script src="{% static 'qiniu/qiniu.js' %}"></script>
<script src="{% static 'web/js/qiniu-custom.js' %}"></script>
<script>
getQiniuUploader({
  browse_button: 'pickfiles',
  container: 'pickfiles_container',
  drop_element: 'pickfiles_container',
  FileUploaded: function(up, file, info) {
     var domain = up.getOption('domain');
     var res = JSON.parse(info);
     var sourceLink = domain + res.key; //获取上传成功后的文件的Url
     $('form input[name="avatar"]').val(sourceLink).valid();
     $('#pickfiles').attr("src", sourceLink).show();
  }
});
</script>

{% endblock %}